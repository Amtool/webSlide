<!DOCTYPE HTML>
<html>
<head>
	<meta charset="UTF-8">
	<title>控制页面</title>
	<script src="/socket.io/socket.io.js"></script>
	<script type="text/javascript">
     
		!function(){
			var socket = io.connect(),$users;
			var $ = function(id){
				return document.getElementById(id);
			}, $$ = function(selector, context){
				context = context || doc;
				return toArray(context.querySelectorAll(selector));
			}, toArray = function(nodelist){
				return [].slice.call(nodelist);
			},
			addUser = function(uid,uname){
				var html = document.createElement('li');
				html.id = 'uid'+uid;
				html.innerHTML = '<label><input type="checkbox" value="'+uid+'" />'+uname+'</label>';
				$users.appendChild(html);
			},
			delUser = function(uid){
				$users.parentNode.removeChild($('uid'+uid));
			};
			
			window.slideSocket = {
//				send:function(key,value){
//	                socket.emit(key,value);
//	            },
	            send:function(value){
	                socket.emit('ctrl ppt action',{action:value});
	            },
				ctrl:function(){
					var uids = [];
					$$('input',$users).forEach(function(el){
						if(el.checked){
							uids.push(el.value);
						}
					});
					socket.emit('ctrl users',{uids:uids});
				},
				init:function(id){
					$users  = $(id);
					socket.on('user connect',function(data){
						addUser(data.uid,data.uname);
					});
					socket.on('user exit',function(data){
						delUser(data.uid);
					});
				}
			};
			window.unload = function(){
                socket.emit('ctrl disconnect');
            };
		}();
	</script>
</head>
<body>
	<ul id="users">
	</ul>
	
	<button onclick="slideSocket.send('prev');">上一页</button>
	<button onclick="slideSocket.send('next');">下一页</button>
	<button onclick="slideSocket.ctrl()">控制所选</button>
    <script type="text/javascript">
    	slideSocket.init('users');
    </script>
</body>
</html>
